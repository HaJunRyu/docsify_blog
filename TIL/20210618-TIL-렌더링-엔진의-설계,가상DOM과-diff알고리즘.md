# 2021년 06월 18일 금요일 TIL(렌더링 엔진의 설계, 가상DOM과 diff알고리즘)

## 오늘 한 일과 느낀점
- 계속 프레임워크 없는 프론트엔드 개발 서적을 읽고있다. 사실 화요일에 카페에 가서 이 책을 읽다가 이해가 잘 되지않아 잠시 알고리즘을 풀고 지금껏 하지 못했던 작업들을 했었다. 근데 이해가 안된다고 회피하고 읽지 않는다면 평생 그 자리라는걸 알기에 어제부터 다시 집중하여 읽기 시작했다. 문제는 단순히 그냥 읽기만 하니까 이해가 안되는것이었고 그래서 이 책의 예제에 나오는 API들에 대해 검색해보고 개념을 정리해나갔다. 핵심적으로 쓰이는것이 requestAnimationFrame이라는 WebAPI인데 자바스크립트의 메인쓰레드를 차단하지 않고(자바스크립트는 싱글쓰레드이니 메인쓰레드가 차단되면 블로킹이 일어난다.) 다음 repaint작업이 이벤트루프에서 스케줄링 되기전에 실행되기 때문에 DOM작업을 하는데 아주 효율적이기 때문이다. 그리고 이제 용어나 API에 대한 지식을 얻었으니 다시 본문으로 돌아갔다. 렌더링 엔진을 설계하는 내용이었는데 지금 글로 100% 풀어낼 순 없겠지만 대략적으로 함수형, 선언형 방식으로 프레임워크 없이 컴포넌트 단위로 개발할때 그 컴포넌트를 렌더링 해주는 각각의 함수를 만들고 그것을 registry객체의 메서드로써 등록해준다. 그리고 그 메서드들의 key값은 구성요소들의 data-component 어트리뷰트의 값으로 정해지게끔 한다. 일단 기본적인 틀을 이렇다. 그리고 이제는 그것들을 이용하여 변경된 요소만을 리렌더링 해주는 diff알고리즘을 적용하여야 하는데 여기서는 root요소로 부터 children들의 변경을 감지하고 실제 적용시켜주는 함수를 재귀적으로 호출함으로써 가장 끝에 있는 node까지 검사하는 알고리즘을 작성했다. 말 그대로 깊이우선 탐색인것이다. 물론 현 React의 reconciliation(재조정) 알고리즘보다 한참 못한 성능이겠지만 지금 이 예시는 TodoList를 예제로 하고있고 충분한 최적화 알고리즘이라고 생각한다. 책에서도 이렇게 애기하고 있다.

> "시기상조의 최적화는 모든(또는 적어도 대부분의)악의 근원이다" - 도널드 크누스(Donald Knuth)

그래서 오늘은 어떻게 가상DOM을 이용하여 실제DOM과 비교하는지 간략하게 알아보는 시간을 가졌다. 이제 React같은 프레임워크를 왜 써야하는지 바닐라 자바스크립트를 쓰면 무엇이 힘든지 뚜렷해지는것 같다. 그냥... 가상DOM, reconciliation만 얘기해도 끝이지만 사실 JSX같은 가독성 좋은 코드의 작성 가능, 탄탄한 커뮤니티와 react와 호환성이 좋은 많은 라이브러리들까지... 프레임워크 없는 프론트엔드 개발 책을 읽고있지만 읽으면 읽을수록 더더욱 프레임워크를 사용함으로써 얻는 생산성의 향상에 대해 느끼게 되는것 같다.

## 내일 할 일
- 약속이 있는날이니 되는대로 책의 3장인 DOM이벤트 관리에 대해 읽고 일요일까지는 이 파트를 다 읽었으면 싶다.
