# 2021년 07월 26일 월요일 TIL(node LTS, React.memo)

## 오늘 한 일과 느낀점

### node LTS

오늘부터 한달동안 enkor라는 회사에서 웹개발을 하기로했다! 그리고 첫 태스크를 받았는데 해외 유학생들이 한국에 입국하고 코로나 방역수칙을 쉽게 숙지할 수 있고 검사결과를 저장할 수 있는 웹사이트가 이미 만들어져있는데 이게 서울시에서 요구사항을 주는것이라고 한다. 그래서 그 요구사항을 해결하는게 오늘의 할 일이었고 프로젝트가 github로 관리되고 있었기에 일단 clone을 하고 패키지를 설치하려고 `npm i` 명령어를 사용하였다. 음... 근데 패키지 설치과정에서 오류가 발생했고 오류 메시지를 읽어보니 처음에는 npm version이 맞지 않아서 많은 오류가 발생했었고 npm을 7버전대에서 enkor회사에서 사용하는 환경인 6.14.13버전으로 다운그레이드 해주었다. 그리고 다시 패키지를 설치했는데 대부분의 에러는 해결이 되었고 node-sass(버전5)패키지가 설치가 안되는 오류를 또 만났다... 그렇게 오래전에 만든게 아닌거 같은데 왜 node-sass를 사용하고 있는지 모르겠지만 node-sass공식문서를 가보니 node-sass 버전5는 현재 LTS버전인 node 14버전 이하에서만 패키지 설치가 가능하다고 하는데 나의 랩탑에는 최신버전인 16버전이 설치되어있어서 그런 오류가 발생했던것이다... 역시 LTS버전이 왜 안정적인건지 다시 한번 알게되었지만 사실 16버전을 그냥 설치한건 아니었고 현재 M1 프로세서를 쓰고있는데 Apple Sillicon프로세서 전용으로 설계된게 16버전 이상이었기때문에 설치한거라 뭔가 아직 M1을 네이티브하게 사용하기에는 무리가 있다는 생각이 한번 더 들었다ㅠ

### React.memo

최근 바닐라 JS로 현재의 SPA프레임워크들을 따라해보는 코드를 작성하기 시작하며 비교 알고리즘과 꼭 필요한 DOM요소만 리렌더링 되는 성능 최적화에 관심이 많이 가기 시작했다. 그리고 최근에 매쉬업 웹팀 면접에서 useCallback과 useMemo를 왜 쓰는지에 대한 질문을 받았고 개념적으로만 객체(함수 포함)를 props로 자식요소에 전달하면 부모 컴포넌트가 리렌더링이 일어날때 해당 객체의 참조값은 항상 바뀌기 때문에 하위 컴포넌트들은 모두 리렌더링이 일어나기 때문에 메모이제이션 패턴으로 참조값을 동일하게 유지해주기 위해 사용해주는걸로 알고는 있었다. 그리고 이제 실제로 내가 사용해야되는떄가 왔고 조금 더 딥하게 파기로하고 직접 테스트도 해봤다. 일단 useCallback과 useMemo는 위에서 말한 내용때문에 사용하는게 맞다. 하지만 그렇게만 사용해서는 성능 최적화를 하지못하고 React.memo를 함께 사용해야한다. 일단 리액트의 컴포넌트가 언제 리렌더링이 되는지 나열해보자.

1. 상태가 변할때
2. props가 변할때
3. 부모 컴포넌트가 렌더링(리렌더링) 됐을때
4. 강제 업데이트를 했을때

그러면 자식 컴포넌트의 입장으로 생각해보자. 참조값이 변하지 않은 props가 전달이 되었다. 그럼 일단 2번의 경우에는 해결이 된것 같다. 하지만 어차피 상위 컴포넌트가 업데이트 되며 하위 컴포넌트가 호출되며 props가 전달되는것이라 props가 변경되지 않았더라고 해도 리렌더링은 일어나게된다. 그래서 초창기 리액트 클래스 컴포넌트에는 shouldComponentUpdate 생명주기 메서드를 이용해서 props를 비교하여 boolean값을 반환하게 하여 쓸데없는 리렌더링을 방지하거나 PureComponent를 extends하여 사용했었다. 하지만 지금은 함수 컴포넌트가 주를 이루고 있고 이전의 방법은 사용하지 못한다. 그래서 사용할 수 있는게 React.memo인데 이것은 고차컴포넌트이며 첫번째 인자로 컴포넌트를 전달하면 부모 요소의 업데이트와 상관없이 해당 컴포넌트의 props가 변했는지만 판단하고 리렌더링 여부를 결정하는 향상된 컴포넌트를 반환한다. 물론 두번째 인자값으로 콜백함수를 작성하여 직접 props를 비교해주는 로직을 짤 수도 있지만 기본적으로는 그냥 사용한다. 결국 useCallback, useMemo만으로는 성능최적화를 할 수 없고 React.memo를 함께 사용해주어야 한다.

## 내일 할 일

- 오전 10시 ~ 오후 7시 Enkor task
- ts로 react-redux를 사용하는 Todo예제 만들어보기
