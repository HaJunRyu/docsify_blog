# 가상 메모리
가상 기억 장치라고도 하며 메모리 관리 기법의 하나로, 기계에 실제로 이용 가능한 기억 자원을 이상적으로 추상화하여 사용자들에게 매우 큰 메모리로 보이게 만드는 것을 말한다. 각 프로세스마다 실제 메모리 주소가 아닌 가상 메모리 주소를 주는 방식이다.  

가상 메모리 방식은 멀티태스킹 운영 체제에서 흔히 사용되고, 실제 주 기억장치보다 큰 메모리 영역을 제공하는 방법으로도 사용된다.  

가상적으로 주어진 주소르르 가상 주소(virtual address)또는 논리 주소(logical address)라고 하며, 실제 메모리(RAM)상에서 유효한 주소를 물리 주소(physical address) 또는 실주소(real address)라고 한다.  

가상 주소의 범위를 가상 주소 공간, 물리 주소의 범위를 물리 주소 공간이라고 한다.

가상 주소 공간은 메모리 관리 장치인 MMU(Memory Management Unit)에 의해서 물리 주소로 변환된다. 그렇기 때문에 개발자는 가상 주소 공간상에서 돌아가는 프로그램을 만들게 되는것이기 때문에 프로그램이나 데이터가 물리 주소 공간에서 어떻게 존재하는지 의식 할 필요가 없어지게 된다.

## 가상 메모리의 기능
가상 메모리의 주요한 기능은 3가지 정도로 요약할 수 있다.  

### 주 기억 장치의 효율적 관리  
주 기억장치를 하드디스크에 대한 캐시로 설정하여, 현재 사용하고 있는 영역만 유지하고 사용하지 않는 데이터는 하드디스크로 옮긴 뒤, 필요할 때만 주 기억장치에 데이터를 불러와 올리고 다시 사용하지 않는다면 하드디스크로 데이터를 내림으로써 주 기억장치를 효과적으로 관리할 수 있다.  

### 메모리 관리의 단순화  
각 프로세스마다 각각의 가상 주소 공간을 가지게 되니 모두 통일된 주소 공간을 배정할 수 있으므로 메모리의 관리가 단순해진다.  

### 메모리 용량 및 안정성 보장  
한정된 공간의 물리 주소 공간이 아닌 거의 무한한 가상 메모리 공간을 배정함으로써 프로세스들끼리 메모리 침범이 일어날 여지를 크게 줄인다.  

정리하자면 가상 주소 공간을 가지고 있기 때문에 프로그램의 모든 코드를 물리 주소 공간에 올려놓을 필요가 없어 물리 주소 공간의 관리가 용이하고, 물리 주소 공간은 1개이기 때문에 데이터가 각각의 다른 주소값을 할당받아야 하지만 가상 주소 공간은 프로세스 당 1개씩 있기때문에 주소값이 같더라도 어차피 다른 프로세스이기 때문에 문제가 되지 않고 그 가상 메모리 주소를 MMU에 요청하면 프로세스의 page table에서 해당하는 물리주소를 반환받을 수 있다.

## MMU
MMU는 CPU가 메모리에 접근하는 것을 관리하는 컴퓨터 하드웨어 부품이다.  
가상 메모리 주소를 실제 메모리 주소로 변환하며, 메모리 보호, 캐시 관리, 버스 중재 등의 역할을 당담한다.

최근에는 MMU가 대부분 CPU내부에 포함되어 있다.  

위에서 각 프로세스는 독립된 가상 주소 공간을 가진다고 했고 그렇기 때문에 모두 통일된 주소 공간을 배정할 수 있다고했다.  
예를 들어 A프로세스에서 0x1000이라는 주소를 가짐과 동시에 B프로세스도 0x1000이라는 주소를 가질 수 있다. 이 두 프로세스에서 각자 0x1000이라는 주소에 접근하는 명령을 실행하는 경우 CPU는 CR3 레지스터에 프로세스마다 별도로 가지고 있는 페이지 테이블 주소가 있는데 그 주소를 가지고 프로세스의 페이지 테이블에 접근한다.  
페이지 테이블은 한 마디로 가상 주소와 실제 주소를 연결시켜주는 테이블이다. 두 프로세스의 가상 주소가 0x1000으로 같다고 해도 각각의 페이지 테이블에서 0x1000이라는 가상 주소에 해당하는 물리주소를 반환해주는것이다. 이때 MMU는 CPU의 CR3레지스터값에 있는 프로세스의 page table에 접근하여 해당 가상 주소 공간에 해당하는 물리 주소를 가지고온다. 그리고 그 물리 주소 공간에 접근하여 데이터를 CPU에 전달해주게 된다.